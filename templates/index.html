<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prédiction des Prix ETF</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous">


    <style>
        body {
            transition: background 0.3s, color 0.3s;
        }
        .dark-mode {
            background: #121212;
            color: white;
        }
        .card {
            border-radius: 12px;
            box-shadow: 3px 3px 15px rgba(0, 0, 0, 0.2);
        }
   
        .trend-up {
            color: green;
            font-size: 18px;
        }
        
        .trend-down {
            color: red;
            font-size: 18px;
        }
        
        .trend-stable {
            color: gray;
            font-size: 18px;
        }

    </style>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="text-primary"><i class="fas fa-chart-line"></i> Prédiction des Prix ETF</h1>
          
        </div>

        <div class="card p-4">
            <form id="prediction-form">
                <label for="sequence" class="form-label"><i class="fas fa-database"></i> Sélectionnez une séquence :</label>
                <div class="mb-3">
                    <select id="predefined-sequences" class="form-select">
                        <option value="">-- Sélectionner une séquence --</option>
                        <option value="10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,21,22,23,24,25,26,27,28,29">Séquence 1</option>
                        <option value="10,11,12,13,14,15,16,17,18,19,20,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79">Séquence 2</option>
                        <option value="100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120">Séquence 3</option>
                    </select>
                </div>

                <div class="mb-3">
                    <input type="text" id="sequence" name="sequence" class="form-control" placeholder="Ex: 10, 11, 12, 13...">
                </div>

                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-magic"></i> Prédire
                </button>
            </form>
        </div>

        <div class="mt-4">
           
            <p id="loading" class="text-warning" style="display:none;"><i class="fas fa-spinner fa-spin"></i> Chargement...</p>

            <div id="predictions-container" class="mt-3">
                <h3 class="text-success"><i class="fas fa-calendar-alt"></i> Prédictions :</h3>
                <table class="table table-bordered table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Date</th>
                            <th>Valeur Prédite</th>
                            <th>Tendance</th>
                        </tr>
                    </thead>
                    <tbody id="predictions-table"></tbody>
                </table>
            </div>

            <img id="plot" src="" class="img-fluid mt-3 shadow" alt="Graphique des Prédictions" style="display:none;">
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('#predefined-sequences').change(function() {
                let selectedSequence = $(this).val();
                $('#sequence').val(selectedSequence);
            });

            $('#prediction-form').submit(function(event) {
                event.preventDefault();
                $('#loading').show();
                $('#predictions-table').empty();
                $('#plot').hide();

                let sequenceInput = $('#sequence').val().trim();
                let sequence = sequenceInput.split(',').map(num => parseFloat(num.trim()));

                $.ajax({
                    url: '/predict',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ sequence: sequence }),
                   success: function(response) {
                        $('#loading').hide();
                        console.log(response); // Vérifier la structure des données
                        
                        let predictions = response.predictions;
                        if (!predictions || predictions.length === 0) {
                            $('#predictions-table').html('<tr><td colspan="3" class="text-center text-danger">Aucune prédiction disponible</td></tr>');
                            return;
                        }
                        
                        let startDate = new Date();
                        startDate.setDate(startDate.getDate() + 1);
                        
                        let tableHtml = "";
                        let prevValue = null; // Commencez par null pour éviter des erreurs
                    
                        for (let i = 0; i < predictions.length; i++) {
                            let currentDate = new Date(startDate);
                            currentDate.setDate(startDate.getDate() + i);
                            let dateFormatted = currentDate.toISOString().split('T')[0];
                    
                            let trendIcon = '<i class="fas fa-equals trend-stable"></i>'; // Par défaut stable
                    
                            if (prevValue !== null) { // Assurez-vous qu'on compare une valeur existante
                                if (predictions[i] > prevValue) {
                                    trendIcon = '<i class="fas fa-arrow-up trend-up"></i>'; // Hausse
                                } else if (predictions[i] < prevValue) {
                                    trendIcon = '<i class="fas fa-arrow-down trend-down"></i>'; // Baisse
                                }
                            }
                    
                            prevValue = predictions[i]; // Mise à jour de prevValue
                    
                            tableHtml += `<tr>
                                <td>${dateFormatted}</td>
                                <td>${predictions[i].toFixed(2)}</td>
                                <td>${trendIcon}</td>
                            </tr>`;
                        }
                    
                        $('#predictions-table').html(tableHtml);
                        $('#plot').attr('src', 'data:image/png;base64,' + response.plot_url).show();
                    },

                    error: function(xhr) {
                        $('#loading').hide();
                        let errorMessage = "Erreur lors de la prédiction.";
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMessage += " " + xhr.responseJSON.error;
                        }
                        alert(errorMessage);
                    }
                });
            });

         
        });
    </script>
</body>
</html>
